/**
 * Copyright (C) 1998-2009 TENCENT Inc.All Rights Reserved.		
 * 																
 * FileName??RequestMDC.java					
 *			
 * Description?????????????????????????????											 
 * History??
 *  ?汾??    ????      ????       ?????????????
 *  1.0     raywu   2010-11-04  Create	
 */
package com.paipai.verticalframework.core;

import java.util.HashMap;
import java.util.Map;

/**
 * ???????????????????????????
 * 
 * @author raywu????????????
 * @version 1.0???°汾???
 * @see ?ο???JavaDoc
 */
public class RequestMDC {

	public final static String USER_NAME = "__UserName"; // ????????j???
	public final static String PROXY_SERVER_IP = "__ProxyIP"; // ?????????IP
	public final static String REQUEST_IP = "__RequestIP"; // ?????IP
	public final static String REQUEST_URI = "__RequestURI"; // ????URI
	public final static String SESSION_ID = "__SessionID"; // ????Session ID
	public final static String THREAD_ID = "__ThreadID"; // ???ID

	private static ThreadLocal<Map<String, Object>> mdc = new ThreadLocal<Map<String, Object>>();

	/**
	 * ?????????????
	 * 
	 * @param name?????
	 * @param value???
	 * @see ?ο???JavaDoc
	 */
	public static synchronized void add(String name, Object value) {
		Map<String, Object> tx = mdc.get();
		if (tx == null) {
			tx = new HashMap<String, Object>();
			mdc.set(tx);
		}
		tx.put(name, value);
	}

	/**
	 * ?????????
	 * 
	 * @param name?????
	 * @return Object
	 * @see ?ο???JavaDoc
	 */
	public static Object get(String name) {
		Map<String, Object> tx = mdc.get();
		if (tx == null) {
			return null;
		}
		else {
			return tx.get(name);
		}
	}

	/**
	 * ??????
	 * 
	 * @see ?ο???JavaDoc
	 */
	public static void clear() {
		mdc.remove();
	}

	/**
	 * ?????ID
	 * 
	 * @return String
	 * @see ?ο???JavaDoc
	 */
	public static String getSystemID() {
		return SystemConfig.getSystemId();
	}

	/**
	 * ???????????????
	 * 
	 * @param userName???????
	 * @see ?ο???JavaDoc
	 */
	public static void setUserName(String userName) {
		add(USER_NAME, userName);
	}

	/**
	 * ????????????
	 * 
	 * @return String
	 * @see ?ο???JavaDoc
	 */
	public static String getUserName() {
		return (String) get(USER_NAME);
	}

	/**
	 * ????????????
	 * 
	 * @param ???????????????У???????????????Χ??
	 * @return ??????????????????????????????????????????????????η???
	 * @exception ?????????????????????????
	 * @see ?ο???JavaDoc
	 */
	public static void setProxyServerIP(String proxyIP) {
		add(PROXY_SERVER_IP, proxyIP);
	}

	/**
	 * ????????????IP
	 * 
	 * @return String
	 * @see ?ο???JavaDoc
	 */
	public static String getProxyServerIP() {
		String ip = (String) get(PROXY_SERVER_IP);
		return (ip == null ? "0.0.0.0" : ip);
	}

	/**
	 * ????????????IP
	 * 
	 * @param String??????????IP
	 * @see ?ο???JavaDoc
	 */
	public static void setRequestIP(String requestIP) {
		add(REQUEST_IP, requestIP);
	}

	/**
	 * ???????????IP
	 * 
	 * @return String
	 * @see ?ο???JavaDoc
	 */
	public static String getRequestIP() {
		String ip = (String) get(REQUEST_IP);
		return (ip == null ? "0.0.0.0" : ip);
	}

	/**
	 * ????????URI
	 * 
	 * @param String??????URI
	 * @see ?ο???JavaDoc
	 */
	public static void setRequestURI(String requestURI) {
		add(REQUEST_URI, requestURI);
	}

	/**
	 * ???????URI
	 * 
	 * @return String
	 * @see ?ο???JavaDoc
	 */
	public static String getRequestURI() {
		return (String) get(REQUEST_URI);
	}

	/**
	 * ????SessionID
	 * 
	 * @param String??SessionID
	 * @see ?ο???JavaDoc
	 */
	public static void setSessionID(String sessionID) {
		add(SESSION_ID, sessionID);
	}

	/**
	 * ???sessionID
	 * 
	 * @return String
	 * @see ?ο???JavaDoc
	 */
	public static String getSessionID() {
		return (String) get(SESSION_ID);
	}

	/**
	 * ???????ID
	 * 
	 * @param long
	 *            ?????ID
	 * @see ?ο???JavaDoc
	 */
	public static void setThreadID(long threadID) {
		add(THREAD_ID, threadID);
	}

	/**
	 * ??????ID
	 * 
	 * @return long
	 * @see ?ο???JavaDoc
	 */
	public static long getThreadID() {
		Long threadID = (Long) get(THREAD_ID);
		return (threadID == null ? 0 : threadID);
	}

	/**
	 * ??????????????????Map
	 * 
	 * @return Map<String, Object>
	 * @see ?ο???JavaDoc
	 */
	public static Map<String, Object> getMDCMap() {
		Map<String, Object> txNew = new HashMap<String, Object>();
		Map<String, Object> tx = mdc.get();
		if (tx != null) {
			txNew.putAll(tx);
		}
		txNew.put(SystemConfig.SYSTEM_KEY, getSystemID());
		return txNew;
	}
}
